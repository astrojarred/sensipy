---
title: source - Source Class
description: API reference for the Source class.
---

import {Aside, Tabs, TabItem} from "@astrojs/starlight/components";

## Source

The `Source` class loads and manages time-resolved spectral models for astrophysical transients.

### Constructor

```python
Source(
    filepath: str | Path,
    min_energy: u.Quantity | None = None,
    max_energy: u.Quantity | None = None,
    ebl: str | None = None,
    times: list[u.Quantity] | None = None,
)
```

**Parameters:**

| Parameter    | Type                       | Description                                            |
| ------------ | -------------------------- | ------------------------------------------------------ |
| `filepath`   | `str \| Path`              | Path to spectral model file (CSV, FITS, or directory)  |
| `min_energy` | `u.Quantity \| None`       | Minimum energy for analysis                            |
| `max_energy` | `u.Quantity \| None`       | Maximum energy for analysis                            |
| `ebl`        | `str \| None`              | EBL model name (`"franceschini"`, `"dominguez"`, etc.) |
| `times`      | `list[u.Quantity] \| None` | Specific times to load (optional)                      |

**Example:**

```python
from sensipy.source import Source
from sensipy.util import get_data_path
from astropy import units as u

# Get path to package mock data
mock_data_path = get_data_path("mock_data/GRB_42_mock.csv")

source = Source(
    filepath=str(mock_data_path),
    min_energy=20 * u.GeV,
    max_energy=10 * u.TeV,
    ebl="franceschini"
)
```

### Attributes

| Attribute      | Type                      | Description                            |
| -------------- | ------------------------- | -------------------------------------- |
| `energy`       | `u.Quantity`              | Energy grid                            |
| `times`        | `u.Quantity`              | Time grid                              |
| `spectra`      | `np.ndarray`              | 2D array of flux values [energy, time] |
| `filepath`     | `Path`                    | Path to source file                    |
| `SpectralGrid` | `RegularGridInterpolator` | Interpolation grid                     |

### Methods

#### `observe()`

Simulate observation to determine required exposure time.

```python
observe(
    sensitivity: Sensitivity,
    start_time: u.Quantity,
    min_energy: u.Quantity,
    max_energy: u.Quantity,
    target_precision: u.Quantity = 1 * u.s,
    max_time: u.Quantity = 12 * u.h,
    sensitivity_mode: Literal["sensitivity", "photon_flux"] = "sensitivity",
    n_time_steps: int = 10,
) -> dict
```

**Returns:** Dictionary with detection results including `obs_time`, `seen`, `start_time`, `end_time`, metadata.

**Example:**

```python
result = source.observe(
    sensitivity=sens,
    start_time=30 * u.min,
    min_energy=20 * u.GeV,
    max_energy=10 * u.TeV,
)
print(result['obs_time'] if result['seen'] else "Not detectable")
```

#### `get_spectrum()`

Get differential flux spectrum at a given time.

```python
get_spectrum(time: u.Quantity, energy: u.Quantity | None = None) -> u.Quantity
```

**Returns:** Flux values at the specified time (and energy if provided).

```python
spectrum = source.get_spectrum(time=100 * u.s)
flux_at_1TeV = source.get_spectrum(time=100 * u.s, energy=1 * u.TeV)
```

#### `get_flux()`

Get differential flux at a given energy.

```python
get_flux(energy: u.Quantity, time: u.Quantity | None = None) -> u.Quantity
```

**Returns:** Flux values at the specified energy (and time if provided).

```python
lightcurve = source.get_flux(energy=1 * u.TeV)
flux_value = source.get_flux(energy=1 * u.TeV, time=100 * u.s)
```

#### `set_ebl_model()`

Set or update EBL absorption model.

```python
set_ebl_model(ebl: str | None, z: float | None = None) -> None
```

**Parameters:**

- `ebl`: EBL model name or `None` to remove
- `z`: Redshift (optional, auto-detected from metadata if available)

```python
source.set_ebl_model("franceschini", z=0.5)
source.set_ebl_model(None)  # Remove EBL
```

#### `show_spectral_pattern()`

Visualize the time-energy spectral evolution.

```python
show_spectral_pattern(
    resolution: int = 100,
    return_plot: bool = False,
    cutoff_flux: u.Quantity = 1e-20 * u.Unit("1 / (cm2 s GeV)"),
) -> plt | None
```

```python
source.show_spectral_pattern(resolution=100)
```

#### `metadata`

Property that returns a copy of the user-defined metadata dictionary. Metadata can be accessed via attribute notation (like pandas DataFrame columns) or through the dictionary.

```python
# Access via attribute notation (recommended)
print(source.event_id)
print(source.distance)
print(source.eiso)

# Or access via the metadata dictionary
meta = source.metadata
print(meta.get('event_id'))
print(meta.get('distance'))
print(meta.get('eiso'))

# Set custom metadata
source.my_custom_field = "value"
print(source.my_custom_field)
```

<Aside type="note">
  Metadata is completely user-definedâ€”there are no built-in metadata fields.
  Keys come from your metadata CSV file or FITS header, and you can add
  custom fields at any time via attribute assignment.
</Aside>

### File Format Support

- **CSV**: Recommended format with `time`, `energy`, `flux` columns
- **FITS**: HDU structure with energy, time, and flux arrays
- **Text directory**: Legacy format with multiple `.txt` files

See [Spectral Models](/working_with_sensipy/spectral_models) for format details.
