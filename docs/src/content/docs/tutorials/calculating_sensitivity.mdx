---
title: Calculating Sensitivity
description: Tutorial on computing sensitivity curves for gamma-ray observatories.
---

import {Aside, Steps, Tabs, TabItem} from "@astrojs/starlight/components";

## Objective

This tutorial demonstrates how to calculate sensitivity curves that determine the minimum detectable flux for a gamma-ray observatory. For comprehensive details about sensitivity calculations, see the [Sensitivity Guide](/getting_started/sensitivity).

## Prerequisites

- IRFs loaded (see [Loading IRFs](./loading_irfs) or [IRFs Guide](/getting_started/irfs))
- A spectral model (see [Spectral Models](/getting_started/spectral_models))

## Basic Sensitivity Calculation

<Steps>

1. **Setup**

   ```python
   from sensipy.ctaoirf import IRFHouse
   from sensipy.sensitivity import Sensitivity
   from sensipy.source import Source
   from astropy import units as u

   # Load IRF
   house = IRFHouse(base_directory="./IRFs/CTAO")
   irf = house.get_irf(
       site="south",
       configuration="alpha",
       zenith=20,
       duration=1800,
       azimuth="average",
       version="prod5-v0.1",
   )
   ```

2. **Define Energy Range**

   ```python
   # Typical CTA energy range
   min_energy = 20 * u.GeV  # or 0.02 TeV
   max_energy = 10 * u.TeV
   ```

3. **Create Sensitivity Calculator**

   ```python
   sens = Sensitivity(
       irf=irf,
       observatory=f"ctao_{irf.site.name}",
       min_energy=min_energy,
       max_energy=max_energy,
       radius=3.0 * u.deg,  # Extraction region
   )
   ```

4. **Load Source Spectrum**

   ```python
   from sensipy.util import get_data_path
   mock_data_path = get_data_path("mock_data/GRB_42_mock.csv")
   
   source = Source(
       filepath=str(mock_data_path),
       min_energy=min_energy,
       max_energy=max_energy,
       ebl="franceschini",
   )
   ```

5. **Compute Sensitivity Curve**

   ```python
   # Calculate sensitivity for this source
   sens.get_sensitivity_curve(source=source)

   print("Sensitivity computed!")
   print(f"Times: {sens.times}")
   print(f"Sensitivity: {sens.sensitivity_curve}")
   ```

</Steps>

## Customizing Time Range

Control the time points where sensitivity is calculated:

```python
import astropy.units as u

sens = Sensitivity(
    irf=irf,
    observatory="ctao_south",
    min_energy=20 * u.GeV,
    max_energy=10 * u.TeV,
    radius=3.0 * u.deg,
    min_time=10 * u.s,        # Minimum time
    max_time=36000 * u.s,     # Maximum time (10 hours)
    n_sensitivity_points=25,  # Number of time points
)

sens.get_sensitivity_curve(source=source)
```

## Querying Sensitivity Values

After computing the sensitivity curve, you can query sensitivity at arbitrary times:

```python
import astropy.units as u

# Get sensitivity at a specific time
time = 1000 * u.s

diff_sens = sens.get(time, mode="sensitivity")
phot_flux = sens.get(time, mode="photon_flux")

print(f"At t={time}:")
print(f"  Differential sensitivity: {diff_sens}")
print(f"  Photon flux sensitivity: {phot_flux}")
```

## Viewing Sensitivity Data

Access the sensitivity data as tables or DataFrames:

```python
# Get as Astropy Table
table = sens.table
print(table)

# Or as Pandas DataFrame
df = sens.pandas
print(df.head())

# Easy plotting with pandas
df.plot(x='time', y='sensitivity', loglog=True)
```

## Comparing Different Configurations

Compare sensitivity for different observatory setups:

```python
from sensipy.ctaoirf import IRFHouse
from sensipy.sensitivity import Sensitivity
from sensipy.source import Source
import astropy.units as u
import matplotlib.pyplot as plt

from sensipy.util import get_data_path

house = IRFHouse(base_directory="./IRFs/CTAO")
mock_data_path = get_data_path("mock_data/GRB_42_mock.csv")
source = Source(
    filepath=str(mock_data_path),
    min_energy=20 * u.GeV,
    max_energy=10 * u.TeV,
)

configs = [
    ("south", 20),
    ("south", 40),
    ("south", 60),
]

plt.figure(figsize=(10, 6))

for site, zenith in configs:
    # Load IRF
    irf = house.get_irf(
        site=site,
        configuration="alpha",
        zenith=zenith,
        duration=1800,
        azimuth="average",
        version="prod5-v0.1",
    )

    # Calculate sensitivity
    sens = Sensitivity(
        irf=irf,
        observatory=f"ctao_{site}",
        min_energy=20 * u.GeV,
        max_energy=10 * u.TeV,
        radius=3.0 * u.deg,
    )
    sens.get_sensitivity_curve(source=source)

    # Plot
    df = sens.pandas
    plt.loglog(df['time'], df['sensitivity'],
               label=f"{site.capitalize()} Z={zenith}°")

plt.xlabel("Observation Time [s]")
plt.ylabel("Differential Sensitivity [erg cm⁻² s⁻¹]")
plt.title("CTA Sensitivity: Different Zenith Angles")
plt.legend()
plt.grid(True, alpha=0.3)
plt.show()
```

## Comparing Different Configurations

Compare sensitivity for different observatory setups:

```python
from sensipy.ctaoirf import IRFHouse
from sensipy.sensitivity import Sensitivity
from sensipy.source import Source
import astropy.units as u
import matplotlib.pyplot as plt

from sensipy.util import get_data_path

house = IRFHouse(base_directory="./IRFs/CTAO")
mock_data_path = get_data_path("mock_data/GRB_42_mock.csv")
source = Source(
    filepath=str(mock_data_path),
    min_energy=20 * u.GeV,
    max_energy=10 * u.TeV,
)

configs = [
    ("south", 20),
    ("south", 40),
    ("south", 60),
]

plt.figure(figsize=(10, 6))

for site, zenith in configs:
    # Load IRF
    irf = house.get_irf(
        site=site,
        configuration="alpha",
        zenith=zenith,
        duration=1800,
        azimuth="average",
        version="prod5-v0.1",
    )

    # Calculate sensitivity
    sens = Sensitivity(
        irf=irf,
        observatory=f"ctao_{site}",
        min_energy=20 * u.GeV,
        max_energy=10 * u.TeV,
        radius=3.0 * u.deg,
    )
    sens.get_sensitivity_curve(source=source)

    # Plot
    df = sens.pandas
    plt.loglog(df['time'], df['sensitivity'],
               label=f"{site.capitalize()} Z={zenith}°")

plt.xlabel("Observation Time [s]")
plt.ylabel("Differential Sensitivity [erg cm⁻² s⁻¹]")
plt.title("CTA Sensitivity: Different Zenith Angles")
plt.legend()
plt.grid(True, alpha=0.3)
plt.show()
```

## Next Steps

- Use sensitivity curves in [Simulating Observations](./simulating_observations)
- See the [Sensitivity Guide](/getting_started/sensitivity) for comprehensive details including:
  - Sensitivity modes (differential vs integral)
  - Advanced customization options
  - Pre-computed curves
  - Troubleshooting tips
- Check the [Sensitivity API Reference](/reference/sensitivity) for detailed documentation
